# Cursor Agent Command

## Recommended Command (with sonnet-4):
```bash
cursor-agent --model "sonnet-4" -p --force --output-format json --approve-mcps "Implement this validated Todo app plan:

## Goal
Create a production-ready SQLite-based Todo application with Next.js 16, Drizzle ORM, Zod validation, and ShadCN UI.

## Phase 1: Dependencies
Install required packages:
pnpm add drizzle-orm better-sqlite3 zod
pnpm add -D @types/better-sqlite3 drizzle-kit

## Phase 2: Database Schema (CRITICAL - Use Exact Schema)
Create migrations/0000_initial.sql:
CREATE TABLE todos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL CHECK(length(title) <= 200),
  description TEXT CHECK(description IS NULL OR length(description) <= 1000),
  completed INTEGER NOT NULL DEFAULT 0 CHECK(completed IN (0, 1)),
  priority TEXT NOT NULL DEFAULT 'medium' CHECK(priority IN ('low', 'medium', 'high')),
  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_todos_completed ON todos(completed);
CREATE INDEX idx_todos_priority ON todos(priority);
CREATE INDEX idx_todos_created_at ON todos(created_at DESC);

CREATE TRIGGER update_todos_timestamp
BEFORE UPDATE ON todos
FOR EACH ROW
WHEN NEW.updated_at = OLD.updated_at
BEGIN
  UPDATE todos SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
END;

## Phase 3: Drizzle Configuration
- Create drizzle.config.ts
- Create src/lib/db.ts (singleton connection with better-sqlite3)
- Create src/lib/schema.ts (Drizzle schema matching SQL above)
- Run migration to create todos.db

## Phase 4: Validation Layer
Create src/lib/validations/todo.ts with Zod schemas:
- createTodoSchema: title (required, max 200), description (optional, max 1000), priority (enum)
- updateTodoSchema: partial of createTodoSchema
- toggleTodoSchema, deleteTodoSchema

## Phase 5: Todo Service
Create src/lib/todo-service.ts with pagination:
- getTodos({ completed?, priority?, limit=20, offset=0 }) -> { todos, total }
- createTodo, updateTodo, deleteTodo, toggleTodo
- Use Drizzle ORM with parameterized queries

## Phase 6: Server Actions
Create src/app/actions/todo-actions.ts:
- Add 'use server' directive
- Validate inputs with Zod
- Return { success, data?, error? }
- Call revalidatePath('/') after mutations
- Actions: createTodo, updateTodo, deleteTodo, toggleTodo

## Phase 7: ShadCN Components
Install: npx shadcn@latest add button input card checkbox dialog badge select
These should go in src/components/ui/

## Phase 8: Todo Components
- src/components/todo-form.tsx: Form with validation and error display
- src/components/todo-item.tsx: Item with useOptimistic for instant updates
- src/components/todo-list.tsx: List with pagination controls
- src/components/todo-filters.tsx: Filter by completed/priority

## Phase 9: Main Page
Update src/app/page.tsx:
- Add: export const runtime = 'nodejs'
- Server-side data fetching with searchParams for pagination
- Render: TodoForm, TodoFilters, TodoList
- Add Suspense boundaries

## Phase 10: Error Handling
- Create src/app/error.tsx
- Create src/app/loading.tsx
- Implement optimistic UI rollback on errors

## Phase 11: Configuration
Update next.config.ts with serverActions configuration

## Phase 12: Testing
- Test all CRUD operations
- Verify pagination works
- Check filters (completed, priority)
- Test optimistic UI
- Run pnpm build to ensure no errors

## Key Requirements
1. Use BEFORE UPDATE trigger (not AFTER) to avoid recursion
2. All columns with NOT NULL constraints where needed
3. Server Actions only (no API routes)
4. Zod validation on client and server
5. Pagination with limit/offset
6. Optimistic UI with useOptimistic
7. Dark mode support (already in project)
8. Mobile-first responsive design

## Expected File Structure
drizzle.config.ts
migrations/0000_initial.sql
src/
  app/
    actions/todo-actions.ts
    error.tsx
    loading.tsx
    page.tsx (runtime: 'nodejs')
  components/
    ui/ (ShadCN)
    todo-form.tsx
    todo-item.tsx
    todo-list.tsx
    todo-filters.tsx
  lib/
    db.ts
    schema.ts
    todo-service.ts
    validations/todo.ts
  types/
    todo.ts

Please implement this complete plan. Show progress as you work through each phase."
```

## Alternative commands:

### Using sonnet-4 (recommended for balanced performance):
```bash
cursor-agent --model "sonnet-4" -p --force --output-format json --approve-mcps "Implement a Todo app with Next.js 16, SQLite (better-sqlite3), Drizzle ORM, Zod validation, and ShadCN UI. Follow the complete plan above."
```

### Using sonnet-4-thinking (for complex reasoning):
```bash
cursor-agent --model "sonnet-4-thinking" -p --force --output-format json --approve-mcps "Implement a Todo app with Next.js 16, SQLite (better-sqlite3), Drizzle ORM, Zod validation, and ShadCN UI. Follow the complete plan above."
```

### Using gpt-5 (latest OpenAI):
```bash
cursor-agent --model "gpt-5" -p --force --output-format json --approve-mcps "Implement a Todo app with Next.js 16, SQLite (better-sqlite3), Drizzle ORM, Zod validation, and ShadCN UI. Follow the complete plan above."
```

## Notes
- This prompt was validated by Codex (gpt-5-codex) with medium reasoning effort
- All previous issues identified by Codex have been addressed
- The plan uses BEFORE UPDATE trigger to avoid recursion
- Database constraints include NOT NULL and length checks
- No API routes (Server Actions only) for better security

## Command Options Explained
- `--model "sonnet-4"`: Uses Claude Sonnet 4 model (best balance)
- `-p, --print`: Headless/script mode (non-interactive)
- `--force`: Auto-approve commands unless explicitly denied
- `--output-format json`: Returns structured JSON output (easier to parse)
- `--approve-mcps`: Auto-approve MCP servers (useful for automation)

## Model Recommendations
- **sonnet-4**: Best balance of speed and quality ‚≠ê **RECOMMENDED**
- **sonnet-4-thinking**: Use for complex architectural decisions
- **gpt-5**: Latest OpenAI model with strong coding
- **gpt-4o**: Fast responses, good for quick iterations
- **composer-1**: Cursor's native composer (older)
